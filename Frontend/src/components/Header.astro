---
// Header.astro
import '../css/header.css';

interface Props {
  isAdmin?: boolean;
}

const { isAdmin = false } = Astro.props;
---

<header class="header">
  <div class="header-container">
    <a href="/" class="logo">
      <img src="/logo.png" alt="TUKO Logo" width="316" height="100" />
    </a>
    
    <button class="hamburger" id="hamburger">
      <span></span>
      <span></span>
      <span></span>
    </button>
    
    <nav class="nav-menu" id="navMenu">
      {isAdmin ? (
        <span class="admin-label">Admin</span>
      ) : (
        <div class="nav-links-wrapper">
          <div class="nav-links">
            <a href="/#" class="nav-link menu-font">Tuko di Rumah</a>
            <a href="/#product" class="nav-link menu-font">Produk</a>
            <a href="/#menu" class="nav-link menu-font">Menu</a>
            <a href="/#outlet" class="nav-link menu-font">Outlet</a>
          </div>
          <a href="/profile" class="profile-section">
            <div class="profile-icon">
              <i data-feather="user" style="color: white; width: 32px; height: 32px;"></i>
            </div>
            <span class="profile-name" id="headerProfileName">Tuko</span>
          </a>
        </div>
      )}
    </nav>
  </div>
</header>

<script>
  function updateHeaderName() {
    const userData = localStorage.getItem('user');
    if (userData) {
      try {
        const user = JSON.parse(userData);
        const nameElement = document.getElementById('headerProfileName');
        if (nameElement) {
          nameElement.textContent = user.name || user.id;
        }
      } catch (e) {
        console.error("Error parsing user data:", e);
      }
    }
  }

  // Hamburger Toggle
  const hamburger = document.getElementById('hamburger');
  const navMenu = document.getElementById('navMenu');

  if (hamburger && navMenu) {
    hamburger.addEventListener('click', (e) => {
      e.stopPropagation();
      hamburger.classList.toggle('active');
      navMenu.classList.toggle('active');
      // Prevent scrolling when menu is open
      document.body.style.overflow = navMenu.classList.contains('active') ? 'hidden' : 'auto';
    });

    // Close menu when clicking links
    const links = navMenu.querySelectorAll('a');
    links.forEach(link => {
      link.addEventListener('click', () => {
        hamburger.classList.remove('active');
        navMenu.classList.remove('active');
        document.body.style.overflow = 'auto';
      });
    });

    // Close when clicking outside
    document.addEventListener('click', (e) => {
      if (navMenu.classList.contains('active') && !navMenu.contains(e.target as Node) && !hamburger.contains(e.target as Node)) {
        hamburger.classList.remove('active');
        navMenu.classList.remove('active');
        document.body.style.overflow = 'auto';
      }
    });
  }

  // Jalankan saat load
  updateHeaderName();
  
  // Listen untuk perubahan storage (opsional jika login sukses)
  window.addEventListener('storage', updateHeaderName);
</script>
